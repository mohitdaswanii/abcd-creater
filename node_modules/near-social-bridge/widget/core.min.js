let viewerPort,state={externalAppUrl:"",initialPath:null,iframeHeight:480,userInfo:null,initialPayload:{},connectMessageSent:!1};function NearSocialBridgeCore(){const[e,t]=React.useState(state.externalAppUrl),[a,n]=React.useState(state.connectMessageSent),[i,o]=React.useState(state.iframeHeight),[,r]=React.useState(state.userInfo);React.useEffect(()=>{const e=e=>{if(viewerPort||"connect-view"!==e.data.type||(viewerPort=e.source,t(e.data.externalAppUrl),o(e.data.initialIframeHeight||480),r(e.data.userInfo),state.externalAppUrl=e.data.externalAppUrl,state.initialPath=e.data.initialPath,state.userInfo=e.data.userInfo,state.initialPayload=e.data.initialPayload,state.iframeHeight=e.data.initialIframeHeight||480),viewerPort&&"view"===e.data.from){if(e.data.type.includes("core:"))return;s(e.data)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]);const s=e=>{document.getElementById("myIframe").contentWindow.postMessage(e,"*")},l=()=>({type:"connect",payload:{userInfo:state.userInfo,initialPath:state.initialPath,initialPayload:state.initialPayload},created_at:Date.now()}),d=e=>{if("external-app"===e.data.from)switch((e=>{viewerPort.postMessage(e,"*")})(e.data),e.data.type){case"nsb:navigation:sync-content-height":c(e.data.type,e.data.payload)}},c=(e,t)=>{t.height&&(o(t.height),state.iframeHeight=t.height);const a=((e,t)=>({from:"core",type:"answer",requestType:e,payload:t}))(e);s(a)};return state.externalAppUrl?React.createElement("iframe",{sandbox:"allow-scripts allow-popups-to-escape-sandbox allow-popups",id:"myIframe",src:e,style:{border:"none",width:"100%",height:i+"px",margin:0,padding:0},onLoad:function(){a||(n(!0),state.connectMessageSent=!0,window.addEventListener("message",d,!1));const e=l();s(e),setTimeout(()=>{s(l())},2e3)}}):null}const domContainer=document.querySelector("#bridge-root"),root=ReactDOM.createRoot(domContainer);root.render(React.createElement(NearSocialBridgeCore,{}));